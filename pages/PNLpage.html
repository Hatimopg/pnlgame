<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PNL Dilemme — Ta musique préférée</title>
  <link rel="stylesheet" href="../styles/PNLstyle.css" />
</head>

<body>
  <div class="bg-orb orb-a"></div>
  <div class="bg-orb orb-b"></div>
  <div class="bg-orb orb-c"></div>

  <header class="topbar">
    <div class="brand">
      <div class="logo">
        <span class="logoDot"></span>
        <span class="logoDot"></span>
        <span class="logoDot"></span>
      </div>
      <div>
        <div class="brandTitle">PNL Dilemme</div>
        <div class="brandSub">Choisis entre 2 sons — on trouve ton préféré</div>
      </div>
    </div>

    <div class="hud">
      <div class="hudItem">
        <div class="hudLabel">Avancement</div>
        <div class="progressWrap">
          <div class="progressBar" id="progressBar"></div>
        </div>
      </div>

      <div class="hudItem hudRight">
        <div class="hudLabel">Duel</div>
        <div class="hudValue"><span id="duelIndex">1</span>/<span id="duelTotal">?</span></div>
      </div>

      <button class="btnGhost" id="btnRestart">↻ Rejouer</button>
    </div>
  </header>

  <main class="stage" id="stage">
    <section class="arena">
      <div class="hint">
        <span class="hintPulse"></span>
        Clique sur la carte de ton choix
      </div>

      <div class="cards" id="cards"></div>

      <div class="microHud">
        <div class="chip" id="chipRound">Round 1</div>
        <div class="chip chipSoft" id="chipRemaining">Chargement…</div>
      </div>
    </section>

    <section class="result hidden" id="result">
      <div class="resultCard">
        <div class="resultTitle">Voici votre musique PNL préférée</div>
        <div class="resultTrack" id="resultTrack"></div>

        <div class="resultCoverWrap">
          <img id="resultCover" class="resultCover">
        </div>

        <div class="resultActions">
          <button class="btnPrimary" id="btnPlayAgain">Rejouer</button>
        </div>
      </div>
    </section>
  </main>

<script>
/* =======================
   DATA
======================= */
const COVER = {
  qlf: "../covers/qlf.jpg",
  lmc: "../covers/lmc.jpeg",
  ddl: "../covers/ddl.jpeg",
  deux: "../covers/deuxfreres.jpeg",
};

const ALBUM_THEMES = {
  "Que La Famille": { left:"#7a0018", right:"#ffffff" },
  "Le Monde Chico": { left:"#0a0a0a", right:"#ff005c" },
  "Dans La Légende": { left:"#f6c100", right:"#ff7a18" },
  "Deux Frères": { left:"#2b6cff", right:"#ff4fd8" },
};

const tracks = [
  ...["Je vis, Je visser","Lala","Différents","Obligés de prendre","Simba"].map(t=>({title:t,album:"Que La Famille",cover:COVER.qlf})),
  ...["Loin des hommes","Mexico","Le M"].map(t=>({title:t,album:"Le Monde Chico",cover:COVER.lmc})),
  ...["DA","Naha","J'suis QLF","Onizuka"].map(t=>({title:t,album:"Dans La Légende",cover:COVER.ddl})),
  ...["Deux frères","Ryuk","Blanka","91's"].map(t=>({title:t,album:"Deux Frères",cover:COVER.deux}))
].map((x,i)=>({id:i+1,...x}));

/* =======================
   GAME
======================= */
let pool = shuffle(tracks);
let next = [];
let pair = [];
let duel = 0;

const cardsEl = document.getElementById("cards");

function shuffle(a){
  return a.sort(()=>Math.random()-0.5);
}

function applyTheme(a,b){
  document.documentElement.style.setProperty("--bg-left", ALBUM_THEMES[a.album].left);
  document.documentElement.style.setProperty("--bg-right", ALBUM_THEMES[b.album].right);
}

function createCard(track){
  const card = document.createElement("button");
  card.className="card";
  card.style.setProperty("--card-glow", ALBUM_THEMES[track.album].right);

  card.innerHTML=`
    <div class="cardFx"></div>
    <div class="coverWrap">
      <img class="cover" src="${track.cover}">
    </div>
    <div class="meta">
      <div class="title">${track.title}</div>
      <div class="sub">${track.album}</div>
    </div>
  `;
  card.onclick=()=>pick(track);
  return card;
}

function render(){
  if(pool.length===1){
    finish(pool[0]);
    return;
  }
  pair=[pool.shift(),pool.shift()];
  applyTheme(pair[0],pair[1]);

  cardsEl.innerHTML="";
  cardsEl.append(createCard(pair[0]),createCard(pair[1]));
}

function pick(winner){
  next.push(winner);
  pool=pool.filter(t=>!pair.includes(t));
  if(pool.length<2){
    pool=[...next];
    next=[];
  }
  render();
}

function finish(w){
  document.getElementById("result").classList.remove("hidden");
  document.getElementById("resultTrack").textContent=w.title;
  document.getElementById("resultCover").src=w.cover;
}

document.getElementById("btnRestart").onclick=()=>location.reload();
document.getElementById("btnPlayAgain").onclick=()=>location.reload();

render();
</script>
</body>
</html>
