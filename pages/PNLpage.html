<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PNL Dilemme ‚Äî Ta musique pr√©f√©r√©e</title>

  <!-- CSS dans /styles -->
  <link rel="stylesheet" href="../styles/PNLstyle.css" />
</head>

<body>
  <div class="bg-orb orb-a"></div>
  <div class="bg-orb orb-b"></div>
  <div class="bg-orb orb-c"></div>

  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <span class="logoDot"></span>
        <span class="logoDot"></span>
        <span class="logoDot"></span>
      </div>
      <div class="brandText">
        <div class="brandTitle">PNL Dilemme</div>
        <div class="brandSub">Choisis entre 2 sons ‚Äî on trouve ton pr√©f√©r√©</div>
      </div>
    </div>

    <div class="hud">
      <div class="hudItem">
        <div class="hudLabel">Avancement</div>
        <div class="progressWrap">
          <div class="progressBar" id="progressBar"></div>
          <div class="progressGlow"></div>
        </div>
      </div>

      <div class="hudItem hudRight">
        <div class="hudLabel">Duel</div>
        <div class="hudValue"><span id="duelIndex">1</span> / <span id="duelTotal">?</span></div>
      </div>

      <button class="btnGhost" id="btnRestart" type="button" title="Recommencer">
        <span class="btnIcon">‚Üª</span> Rejouer
      </button>
    </div>
  </header>

  <main class="stage" id="stage">
    <section class="arena" id="arena">
      <div class="hint" id="hint">
        <span class="hintPulse"></span>
        Clique sur la carte de ton choix
      </div>

      <div class="cards" id="cards">
        <!-- Cartes inject√©es en JS -->
      </div>

      <div class="microHud">
        <div class="chip" id="chipRound">Round 1</div>
        <div class="chip chipSoft" id="chipRemaining">Chargement‚Ä¶</div>
      </div>
    </section>

    <section class="result hidden" id="result">
      <div class="resultCard">
        <div class="resultSpark"></div>
        <div class="resultTitle">Voici votre musique PNL pr√©f√©r√©e</div>
        <div class="resultTrack" id="resultTrack">‚Äî</div>

        <div class="resultCoverWrap">
          <img id="resultCover" class="resultCover" alt="Cover" />
          <div class="resultRing"></div>
        </div>

        <div class="resultActions">
          <button class="btnPrimary" id="btnPlayAgain" type="button">Rejouer</button>
          <button class="btnGhost" id="btnShare" type="button">Copier le r√©sultat</button>
        </div>

        <div class="toast" id="toast">Copi√© ‚úÖ</div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footerLeft">Covers: /covers ¬∑ CSS: /styles</div>
    <div class="footerRight">Animations + tournoi al√©atoire</div>
  </footer>
  
  <script>
  // =========================
  // 1) DATA ‚Äî titres + covers
  // =========================
  const COVER = {
    qlf: "../covers/qlf.jpg",
    lmc: "../covers/lmc.jpeg",
    ddl: "../covers/ddl.jpeg",
    df: "../covers/deuxfreres.jpeg",
  };

  const ALBUM_THEMES = {
    "Que La Famille": { a: "#ff4fd8", b: "#ffffff" },
    "Le Monde Chico": { a: "#050505", b: "#4a0013" },
    "Dans La L√©gende": { a: "#ff7a18", b: "#ffb199" },
    "Deux Fr√®res": { a: "#2b6cff", b: "#ff4fd8" },
  };

  const album1 = [
    {title:"Je vis, Je visser", file:"../musics/qlf/jevisjevisser.mp3"},
    {title:"Lala", file:"../musics/qlf/lala.mp3"},
    {title:"Diff√©rents", file:"../musics/qlf/differents.mp3"},
    {title:"Oblig√©s de prendre", file:"../musics/qlf/obligesdeprendre.mp3"},
    {title:"De la fen√™tre au ter-ter", file:"../musics/qlf/fenetre.mp3"},
    {title:"PNL", file:"../musics/qlf/pnl.mp3"},
    {title:"J'comprends pas", file:"../musics/qlf/jcomprendspas.mp3"},
    {title:"Gala Gala", file:"../musics/qlf/gala.mp3"},
    {title:"La petite voix", file:"../musics/qlf/petitevoix.mp3"},
    {title:"Ath√©na", file:"../musics/qlf/athena.mp3"},
    {title:"Recherche du bonheur", file:"../musics/qlf/recherche.mp3"},
    {title:"Simba", file:"../musics/qlf/simba.mp3"},
  ].map(t => ({
  title: t.title,
  file: t.file,
  album: "Que La Famille",
  cover: COVER.qlf
}));

  const album2 = [
    {title:"Le monde ou rien", file:"../musics/lmc/lemondeourien.mp3"},
    {title:"Sur Paname", file:"../musics/lmc/surpaname.mp3"},
    {title:"Oh lala", file:"../musics/lmc/ohlala.mp3"},
    {title:"J'vends", file:"../musics/lmc/jvends.mp3"},
    {title:"Abonn√©", file:"../musics/lmc/abonne.mp3"},
    {title:"J'suis PNL", file:"../musics/lmc/jsuispnl.mp3"},
    {title:"Mexico", file:"../musics/lmc/mexico.mp3"},
    {title:"Porte de Mesrine", file:"../musics/lmc/porte.mp3"},
    {title:"Dans ta rue", file:"../musics/lmc/danstarue.mp3"},
    {title:"Laisse", file:"../musics/lmc/laisse.mp3"},
    {title:"Loin des hommes", file:"../musics/lmc/loin.mp3"},
    {title:"Le M", file:"../musics/lmc/M.mp3"},
    {title:"Rebenga", file:"../musics/lmc/rebenga.mp3"},
    {title:"Plus Tony que Sosa", file:"../musics/lmc/ptsq.mp3"},
    {title:"Que la mif", file:"../musics/lmc/qlm.mp3"},
    {title:"Temp√™te", file:"../musics/lmc/tempete.mp3"},
    {title:"Dans la soucoupe", file:"../musics/lmc/soucoupe.mp3"},
  ].map(t => ({
  title: t.title,
  file: t.file,
  album: "Le Monde Chico",
  cover: COVER.lmc
}));


  const album3 = [
    {title: "Da", file:"../musics/ddl/da.mp3"},
    {title: "Naha", file:"../musics/ddl/naha.mp3"},
    {title: "Dans la l√©gende", file:"../musics/ddl/ddl.mp3"},
    {title: "Mira", file:"../musics/ddl/mira.mp3"} ,
    {title: "J'suis QLF", file:"../musics/ddl/jsuisqlf.mp3"},
    {title: "La vie est belle", file:"../musics/ddl/lavie.mp3"},
    {title: "Kratos", file:"../musics/ddl/kratos.mp3"},
    {title: "Luz de Luna", file:"../musics/ddl/luz.mp3"},
    {title: "Tu sais pas", file:"../musics/ddl/tusaispas.mp3"},
    {title: "Sheita", file:"../musics/ddl/sheita.mp3"},
    {title: "Humain", file:"../musics/ddl/humain.mp3"},
    {title: "Bambina", file:"../musics/ddl/bambina.mp3"},
    {title: "Ben√©", file:"../musics/ddl/bene.mp3"} ,
    {title: "Uranus", file:"../musics/ddl/uranus.mp3"},
    {title: "Onizuka", file:"../musics/ddl/onizuka.mp3"},
    {title: "Jusq'au dernier gramme", file:"../musics/ddl/gramme.mp3"},
    {title: "Cram√©s", file:"../musics/ddl/crames.mp3"},
    {title: "Je t'haine", file:"../musics/ddl/jethaine.mp3"},
  ].map(t => ({
  title: t.title,
  file: t.file,
  album: "Dans La L√©gende",
  cover: COVER.ddl
}));


  const album4 = [
    {title: "Au DD", file:"../musics/df/audd.mp3"},
    {title: "Autre monde", file:"../musics/df/autremonde.mp3"},
    {title: "Chang", file:"../musics/df/chang.mp3"},
    {title: "Blanka", file:"../musics/df/blanka.mp3"},
    {title: "91's", file:"../musics/df/91s.mp3"},
    {title: "A l'ammoniaque", file:"../musics/df/ammoniaque.mp3"},
    {title: "Celsius", file:"../musics/df/celsius.mp3"},
    {title: "Deux fr√®res", file:"../musics/df/deuxfreres.mp3"},
    {title: "Hasta la vista", file:"../musics/df/hasta.mp3"},
    {title: "C≈ìurs", file:"../musics/df/coeurs.mp3"},
    {title: "Shenmue", file:"../musics/df/shenmue.mp3"},
    {title: "Kuta Ubud", file:"../musics/df/kutaubud.mp3"},
    {title: "Menace", file:"../musics/df/menace.mp3"},
    {title: "Zoulou Tchaing", file:"../musics/df/zoulou.mp3"},
    {title: "D√©connect√©", file:"../musics/df/deconnecte.mp3"},
    {title: "La mis√®re est si belle", file:"../musics/df/misere.mp3"},
    {title: "Ryuk", file:"../musics/df/ryuk.mp3"},
    {title: "Comme pas deux", file:"../musics/df/commepasdeux.mp3"},
    {title: "Sib√©rie", file:"../musics/df/siberie.mp3"},
    {title: "Bang", file:"../musics/df/bang.mp3"},
    {title: "Capuche", file:"../musics/df/capuche.mp3"},
    {title: "Fronti√®res", file:"../musics/df/frontieres.mp3"},
  ].map(t => ({
  title: t.title,
  file: t.file,
  album: "Deux Fr√®res",
  cover: COVER.df
}));


  const ALL_TRACKS = [...album1, ...album2, ...album3, ...album4]
    .map((x, i) => ({ id: i + 1, ...x }));

  // =========================
  // 2) Helpers
  // =========================
  const $ = (sel) => document.querySelector(sel);
  const cardsEl = $("#cards");
  const resultEl = $("#result");
  const stageEl = $("#stage");
  const arenaEl = $("#arena");
  const toastEl = $("#toast");
  const progressBar = $("#progressBar");
  const duelIndexEl = $("#duelIndex");
  const duelTotalEl = $("#duelTotal");
  const chipRound = $("#chipRound");
  const chipRemaining = $("#chipRemaining");

  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function clamp(n, min, max) {
    return Math.max(min, Math.min(max, n));
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function mixHex(c1, c2, t = 0.5) {
    const a = hexToRgb(c1), b = hexToRgb(c2);
    return rgbToHex(
      Math.round(a.r + (b.r - a.r) * t),
      Math.round(a.g + (b.g - a.g) * t),
      Math.round(a.b + (b.b - a.b) * t)
    );
  }

  function hexToRgb(hex) {
    const n = parseInt(hex.replace("#", ""), 16);
    return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 };
  }

  function rgbToHex(r, g, b) {
    return "#" + [r, g, b].map(v => v.toString(16).padStart(2, "0")).join("");
  }

  function themeForAlbum(album) {
    return ALBUM_THEMES[album];
  }

  function applyDuelTheme(left, right) {
    const L = themeForAlbum(left.album);
    const R = themeForAlbum(right.album);

    arenaEl.style.setProperty("--bg-left", mixHex(L.a, L.b, 0.5));
    arenaEl.style.setProperty("--bg-right", mixHex(R.a, R.b, 0.5));
    arenaEl.style.setProperty("--bg-mid", mixHex(L.a, R.b, 0.5));
  }

  // =========================
  // 3) GAME STATE (CHAMPION)
  // =========================
  let currentChampion = null;
  let currentPool = [];
  let duelIndex = 0;
  let duelTotal = 0;
  let locked = false;

  function resetGame() {
    locked = false;

    resultEl.classList.add("hidden");
    stageEl.classList.remove("done");

    const shuffled = shuffle(ALL_TRACKS);
    currentChampion = shuffled.shift(); // üëë premier son
    currentPool = shuffled;

    duelIndex = 0;
    duelTotal = ALL_TRACKS.length - 1;
    duelTotalEl.textContent = duelTotal;

    updateHud();
    renderNext();
  }

  function updateHud() {
    duelIndexEl.textContent = Math.max(1, duelIndex);
    chipRound.textContent = "Dilemme";
    chipRemaining.textContent = `${currentPool.length} titres restants`;

    const pct = clamp((duelIndex / duelTotal) * 100, 0, 100);
    progressBar.style.width = pct + "%";
  }

  function renderNext() {
    if (currentPool.length === 0) {
      return finish(currentChampion);
    }

    const challenger = currentPool.shift();
    duelIndex++;
    updateHud();

    cardsEl.innerHTML = "";
    applyDuelTheme(currentChampion, challenger);

    cardsEl.appendChild(createCard(currentChampion));
    cardsEl.appendChild(createCard(challenger));
  }

  function createCard(track) {
  const theme = themeForAlbum(track.album);
  const isDark = track.album === "Le Monde Chico";

  const card = document.createElement("button");
  card.className = "card in";
  card.style.setProperty("--accent", mixHex(theme.a, theme.b, 0.5));

  card.innerHTML = `
    <div class="cardFx">
      <div class="cardSheen"></div>
      <div class="cardBorder"></div>
      <div class="cardNoise"></div>
    </div>

    <div class="coverWrap">
      <img class="cover" src="${track.cover}">
      <div class="coverGlow"></div>
      <div class="coverScan"></div>
    </div>

    <div class="meta" style="color:${isDark ? "#ffffff" : "inherit"}">
      <div class="title">${escapeHtml(track.title)}</div>
      <div class="sub">${escapeHtml(track.album)}</div>

      <audio controls class="audio">
        <source src="${track.file}" type="audio/mpeg">
      </audio>
    </div>

    <div class="pickHint">
      <span class="pickDot"></span> Choisir
    </div>
  `;

  card.onclick = () => onPick(track);
  return card;
}


  function onPick(track) {
    if (locked) return;
    locked = true;

    const isChampion = track.id === currentChampion.id;
    currentChampion = isChampion ? currentChampion : track;

    setTimeout(() => {
      locked = false;
      renderNext();
    }, 450);
  }

  function finish(winner) {
    stageEl.classList.add("done");
    resultEl.classList.remove("hidden");
    $("#resultTrack").textContent = winner.title;
    $("#resultCover").src = winner.cover;
    progressBar.style.width = "100%";
    chipRemaining.textContent = "Termin√© ‚úÖ";
  }

  // =========================
  // 4) Buttons
  // =========================
  $("#btnRestart").onclick = resetGame;
  $("#btnPlayAgain").onclick = resetGame;

  $("#btnShare").onclick = async () => {
    const text = `Ma musique PNL pr√©f√©r√©e : ${$("#resultTrack").textContent}`;
    try {
      await navigator.clipboard.writeText(text);
      toastEl.classList.add("show");
      setTimeout(() => toastEl.classList.remove("show"), 1000);
    } catch {}
  };

  // =========================
  // 5) Start
  // =========================
  resetGame();
  </script>

</body>
</html>